{% extends "base.html" %}

{% block title %}Tax Review - Freedom US Tax Return{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-12">
            <!-- Progress Bar -->
            <div class="progress mb-4" style="height: 8px;">
                <div class="progress-bar bg-success" role="progressbar" style="width: 100%;"
                     aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <!-- Header -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-check-circle"></i> Tax Calculation Complete
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <h5 class="alert-heading">
                            <i class="fas fa-calculator"></i> Your Tax Return Summary for {{ current_year }}
                        </h5>
                        <p class="mb-0">Review your tax calculation below. You can go back to make changes or proceed to file your return.</p>
                    </div>

                    <!-- Tax Summary Cards -->
                    <div class="row g-4 mb-4">
                        <!-- Income Summary -->
                        <div class="col-md-6">
                            <div class="card h-100 border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-dollar-sign"></i> Income Summary
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <strong>Gross Income:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.gross_income) }}</span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>Adjustments:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.adjustments) }}</span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>Adjusted Gross Income:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.agi) }}</span>
                                    </div>
                                    <hr>
                                    <div class="mb-0">
                                        <strong>Taxable Income:</strong>
                                        <span class="float-end fw-bold">${{ "%.2f"|format(result.taxable_income) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tax Calculation -->
                        <div class="col-md-6">
                            <div class="card h-100 border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0">
                                        <i class="fas fa-calculator"></i> Tax Calculation
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <strong>Income Tax:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.income_tax) }}</span>
                                    </div>
                                    {% if result.self_employment_tax %}
                                    <div class="mb-2">
                                        <strong>Self-Employment Tax:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.self_employment_tax) }}</span>
                                    </div>
                                    {% endif %}
                                    {% if result.alternative_minimum_tax %}
                                    <div class="mb-2">
                                        <strong>Alternative Minimum Tax:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.alternative_minimum_tax) }}</span>
                                    </div>
                                    {% endif %}
                                    {% if result.net_investment_income_tax %}
                                    <div class="mb-2">
                                        <strong>Net Investment Income Tax:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.net_investment_income_tax) }}</span>
                                    </div>
                                    {% endif %}
                                    <div class="mb-2">
                                        <strong>Credits:</strong>
                                        <span class="float-end text-success">-${{ "%.2f"|format(result.total_credits) }}</span>
                                    </div>
                                    <hr>
                                    <div class="mb-0">
                                        <strong>Total Tax:</strong>
                                        <span class="float-end fw-bold">${{ "%.2f"|format(result.total_tax) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payments and Refund/Owed -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <div class="card h-100 border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-credit-card"></i> Payments & Withholdings
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <strong>Federal Tax Withheld:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.federal_withheld) }}</span>
                                    </div>
                                    {% if result.estimated_payments %}
                                    <div class="mb-2">
                                        <strong>Estimated Payments:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.estimated_payments) }}</span>
                                    </div>
                                    {% endif %}
                                    {% if result.other_payments %}
                                    <div class="mb-2">
                                        <strong>Other Payments:</strong>
                                        <span class="float-end">${{ "%.2f"|format(result.other_payments) }}</span>
                                    </div>
                                    {% endif %}
                                    <hr>
                                    <div class="mb-0">
                                        <strong>Total Payments:</strong>
                                        <span class="float-end fw-bold">${{ "%.2f"|format(result.total_payments) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Final Result -->
                        <div class="col-md-6">
                            <div class="card h-100 {% if result.amount_owed > 0 %}border-danger{% else %}border-success{% endif %}">
                                <div class="card-header {% if result.amount_owed > 0 %}bg-danger{% else %}bg-success{% endif %} text-white">
                                    <h6 class="mb-0">
                                        {% if result.amount_owed > 0 %}
                                            <i class="fas fa-exclamation-triangle"></i> Amount Owed
                                        {% else %}
                                            <i class="fas fa-check-circle"></i> Refund Due
                                        {% endif %}
                                    </h6>
                                </div>
                                <div class="card-body text-center">
                                    {% if result.amount_owed > 0 %}
                                        <h2 class="text-danger mb-3">${{ "%.2f"|format(result.amount_owed) }}</h2>
                                        <p class="mb-0">You owe this amount to the IRS. Payment is due by April 15, {{ current_year + 1 }}.</p>
                                    {% else %}
                                        <h2 class="text-success mb-3">${{ "%.2f"|format(result.refund_amount) }}</h2>
                                        <p class="mb-0">You will receive this refund from the IRS.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    {% if analytics %}
                    <div class="card mb-4">
                        <div class="card-header bg-secondary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-line"></i> Tax Analytics
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-primary">{{ "%.1f"|format(analytics.effective_tax_rate) }}%</div>
                                        <small class="text-muted">Effective Tax Rate</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-info">{{ "%.1f"|format(analytics.deduction_percentage) }}%</div>
                                        <small class="text-muted">Deduction Rate</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-success">{{ "%.1f"|format(analytics.credit_utilization) }}%</div>
                                        <small class="text-muted">Credit Utilization</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="h4 text-warning">{{ analytics.risk_level }}</div>
                                        <small class="text-muted">Audit Risk</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-center gap-3">
                        <a href="{{ url_for('payments') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-edit"></i> Make Changes
                        </a>
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print"></i> Print Summary
                        </button>
                        <button class="btn btn-success" onclick="downloadPDF()">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                        <button class="btn btn-warning" onclick="fileElectronically()">
                            <i class="fas fa-paper-plane"></i> File Electronically
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
function downloadPDF() {
    // This would trigger PDF generation
    alert('PDF download feature coming soon!');
}

function fileElectronically() {
    // This would start the e-filing process
    alert('Electronic filing feature coming soon!');
}
</script>
{% endblock %}
{% endblock %}