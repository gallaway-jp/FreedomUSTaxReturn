{% extends "base.html" %}

{% block title %}Personal Information - Freedom US Tax Return{% endblock %}

{% block progress %}
<div class="progress-container bg-light py-2">
    <div class="container">
        <div class="progress" style="height: 8px;">
            <div class="progress-bar bg-primary" role="progressbar" style="width: 16.67%;" aria-valuenow="1" aria-valuemin="0" aria-valuemax="6"></div>
        </div>
        <div class="d-flex justify-content-between mt-1">
            <small class="text-primary fw-bold">Personal Info</small>
            <small class="text-muted">Step 1 of 6</small>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="card-title mb-0">
                    <i class="fas fa-user"></i> Personal Information
                </h4>
            </div>
            <div class="card-body">
                <form id="personal-info-form">
                    <div class="row g-3">
                        <!-- Full Name -->
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">First Name *</label>
                            <input type="text" class="form-control" id="first_name"
                                   value="{{ personal_info.first_name or '' }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Last Name *</label>
                            <input type="text" class="form-control" id="last_name"
                                   value="{{ personal_info.last_name or '' }}" required>
                        </div>

                        <!-- SSN -->
                        <div class="col-12">
                            <label for="ssn" class="form-label">Social Security Number *</label>
                            <input type="text" class="form-control" id="ssn"
                                   placeholder="XXX-XX-XXXX" maxlength="11"
                                   value="{{ personal_info.ssn or '' }}" required>
                            <div class="form-text">We'll mask this for security</div>
                        </div>

                        <!-- Address -->
                        <div class="col-12">
                            <label for="address" class="form-label">Street Address *</label>
                            <input type="text" class="form-control" id="address"
                                   value="{{ personal_info.address or '' }}" required>
                        </div>

                        <div class="col-md-4">
                            <label for="city" class="form-label">City *</label>
                            <input type="text" class="form-control" id="city"
                                   value="{{ personal_info.city or '' }}" required>
                        </div>
                        <div class="col-md-4">
                            <label for="state" class="form-label">State *</label>
                            <select class="form-select" id="state" required>
                                <option value="">Select State</option>
                                {% for state_code, state_name in [
                                    ('AL', 'Alabama'), ('AK', 'Alaska'), ('AZ', 'Arizona'), ('AR', 'Arkansas'),
                                    ('CA', 'California'), ('CO', 'Colorado'), ('CT', 'Connecticut'), ('DE', 'Delaware'),
                                    ('FL', 'Florida'), ('GA', 'Georgia'), ('HI', 'Hawaii'), ('ID', 'Idaho'),
                                    ('IL', 'Illinois'), ('IN', 'Indiana'), ('IA', 'Iowa'), ('KS', 'Kansas'),
                                    ('KY', 'Kentucky'), ('LA', 'Louisiana'), ('ME', 'Maine'), ('MD', 'Maryland'),
                                    ('MA', 'Massachusetts'), ('MI', 'Michigan'), ('MN', 'Minnesota'), ('MS', 'Mississippi'),
                                    ('MO', 'Missouri'), ('MT', 'Montana'), ('NE', 'Nebraska'), ('NV', 'Nevada'),
                                    ('NH', 'New Hampshire'), ('NJ', 'New Jersey'), ('NM', 'New Mexico'), ('NY', 'New York'),
                                    ('NC', 'North Carolina'), ('ND', 'North Dakota'), ('OH', 'Ohio'), ('OK', 'Oklahoma'),
                                    ('OR', 'Oregon'), ('PA', 'Pennsylvania'), ('RI', 'Rhode Island'), ('SC', 'South Carolina'),
                                    ('SD', 'South Dakota'), ('TN', 'Tennessee'), ('TX', 'Texas'), ('UT', 'Utah'),
                                    ('VT', 'Vermont'), ('VA', 'Virginia'), ('WA', 'Washington'), ('WV', 'West Virginia'),
                                    ('WI', 'Wisconsin'), ('WY', 'Wyoming')
                                ] %}
                                <option value="{{ state_code }}" {% if personal_info.state == state_code %}selected{% endif %}>
                                    {{ state_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="zip_code" class="form-label">ZIP Code *</label>
                            <input type="text" class="form-control" id="zip_code"
                                   placeholder="12345" maxlength="10"
                                   value="{{ personal_info.zip_code or '' }}" required>
                        </div>

                        <!-- Contact Info -->
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email"
                                   value="{{ personal_info.email or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone"
                                   placeholder="(555) 123-4567"
                                   value="{{ personal_info.phone or '' }}">
                        </div>

                        <!-- Date of Birth -->
                        <div class="col-md-6">
                            <label for="date_of_birth" class="form-label">Date of Birth *</label>
                            <input type="date" class="form-control" id="date_of_birth"
                                   value="{{ personal_info.date_of_birth or '' }}" required>
                        </div>

                        <!-- Occupation -->
                        <div class="col-md-6">
                            <label for="occupation" class="form-label">Occupation</label>
                            <input type="text" class="form-control" id="occupation"
                                   value="{{ personal_info.occupation or '' }}">
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </a>
                        <button type="submit" class="btn btn-primary">
                            Continue <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('personal-info-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        ssn: document.getElementById('ssn').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        zip_code: document.getElementById('zip_code').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        date_of_birth: document.getElementById('date_of_birth').value,
        occupation: document.getElementById('occupation').value
    };

    fetch('/personal-info', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = '/filing-status';
        } else {
            alert('Error saving personal information');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving personal information');
    });
});

// SSN formatting
document.getElementById('ssn').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 3 && value.length < 5) {
        value = value.slice(0, 3) + '-' + value.slice(3);
    } else if (value.length >= 5) {
        value = value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5, 9);
    }
    e.target.value = value;
});

// Phone formatting
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 3 && value.length < 6) {
        value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
    } else if (value.length >= 6) {
        value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
    }
    e.target.value = value;
});
</script>
{% endblock %}